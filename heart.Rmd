---
title: "Heart Disease Analysis"
author: "Tyler Campbell"
date: "2025-12-30"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, warning = FALSE}
library(ggplot2)
library(dplyr)
library(MASS)
library(ca)
library(CCA)
library(sem)

library(corrplot)
library(MVA)
library(kableExtra)
```

```{r}
# Loading Data
data <- read.csv("C:/Users/Ty Campbell/Desktop/Heart_Disease_Prediction.csv")
head(data)
```

```{r}
# checking data types and null values
dim(data)
colSums(is.na(data))
str(data)
```
```{r}
# preprocessing and standardization
data$Heart.Disease <- ifelse(data$Heart.Disease == "Presence", 1, 0)


```

```{r}
df <- data %>%
  mutate(across(-Heart.Disease, scale))

head(df)
```

```{r}
# data partitioning

n <- nrow(df)
idx <- sample(1:n, size = .7 * n)
train <- df[idx,]
valid <- df[-idx,]
dim(train)
dim(valid)
```
```{r}
# logit model
logit_model <- glm(Heart.Disease ~ ., data = train, family = "binomial")
logit_predict <- predict(logit_model, newdata = valid, type = "response")
logit_class <- ifelse(logit_predict > .5, 1, 0)
table(Predicted = logit_class, Actual = valid$Heart.Disease)
mean(logit_class == valid$Heart.Disease)
```
```{r}
# logit performance 
TP <- 21
TN <- 41
FP <- 10
FN <- 9

accuracy  <- (TP + TN) / (TP + TN + FP + FN)
precision <- TP / (TP + FP)
recall    <- TP / (TP + FN)
specificity <- TN / (TN + FP)

accuracy
precision
recall
specificity

```
```{r}
# install.packages("xgboost")
library(xgboost)

# Assume train and valid have Heart.Disease as 0/1
y_train <- train$Heart.Disease
y_valid <- valid$Heart.Disease

X_train <- model.matrix(Heart.Disease ~ . - 1, data = train)
X_valid <- model.matrix(Heart.Disease ~ . - 1, data = valid)

dtrain <- xgb.DMatrix(data = X_train, label = y_train)
dvalid <- xgb.DMatrix(data = X_valid, label = y_valid)

params <- list(
  objective = "binary:logistic",
  eval_metric = "logloss",
  eta = 0.05,
  max_depth = 4,
  subsample = 0.8,
  colsample_bytree = 0.8
)

watch <- list(train = dtrain, valid = dvalid)

xgb_fit <- xgb.train(
  params = params,
  data = dtrain,
  nrounds = 500,
  watchlist = watch,
  early_stopping_rounds = 25,
  verbose = 0
)

p_valid <- predict(xgb_fit, dvalid)          # probabilities
pred_valid <- ifelse(p_valid > 0.5, 1, 0)    # class

table(Predicted = pred_valid, Actual = y_valid)
mean(pred_valid == y_valid)

```
```{r}
library(randomForest)

rf_model <- randomForest(as.factor(Heart.Disease) ~ ., data = train, ntree = 1000, mtry = 3, importance = TRUE)
rf_predict <- predict(rf_model, newdata = valid)

table(Predicted = rf_predict, Actual = valid$Heart.Disease)
mean(rf_predict == valid$Heart.Disease)
```
# Visualizations

```{r}
ggplot(data, aes(x = factor(Heart.Disease))) +
         geom_bar(fill = "tomato", col = "black") +
         labs(
           title = "Heart Disease Distribution",
           x = "Heart Disease (1 or 0)",
           y = "Count"
         ) +
         theme_minimal() +
         theme(legend.position = "none")
```
```{r}
ggplot(data, aes(x = Age)) +
  geom_histogram(
    bins = 20,
    fill = "tomato",
    col = "white"
  ) +
  labs(
    title = "Age Histogram",
    x = "Age",
    y = "Count"
  ) +
  theme_minimal()
```
```{r}
ggplot(data, aes(x = factor(Heart.Disease), y = Age)) +
  geom_boxplot(
    fill = "tomato"
  ) +
  labs(
    title = "Heart Disease by Age",
    x = "Disease Status", 
    y = "Age"
  ) +
  theme_minimal()
```
```{r}
ggplot(data, aes(x = Age, fill = factor(Heart.Disease))) +
  geom_density(
    alpha = 0.5
    ) +
  labs(
    title = "Density Plot",
    x = "Age",
    fill = "Heart Disease"
  ) +
  theme_minimal()
```
```{r}
ggplot(data, aes(x = Cholesterol)) +
  geom_histogram(
    bins = 20,
    fill = "tomato",
    col = "white"
  ) +
  labs(
    title = "Histogram of Cholesterol",
    x = "Cholesterol",
    y = "Count"
  ) +
  theme_minimal()
```
```{r}
ggplot(data, aes(x = factor(Heart.Disease), y = Cholesterol)) +
  geom_boxplot(
    fill = "tomato"
  ) +
  labs(
    title = "Cholesterol Boxplot",
    x = "Heart Disease",
    y = "cholesterol"
  ) +
  theme_minimal()
```
```{r}
ggplot(data, aes(x = Cholesterol, fill = factor(Heart.Disease))) +
  geom_density(
    alpha = .5
  ) +
  labs(
    title = "cholesterol density",
    x = "cholesterol",
    y = "density",
    fill = "Heart Disease"
  ) +
  theme_minimal()
```


```{r}
ggplot(data, aes(x = Age, y = Cholesterol, color = factor(Heart.Disease))) +
  geom_point(alpha = 0.7) +
  labs(
    title = "Scatter",
    x = "Age",
    y = "cholesterol",
    color = "Heart disease"
  ) +
  theme_minimal()
```
```{r}
data$logit_prob <- predict(logit_model, newdata = df, type = "response")
```

```{r}
ggplot(data, aes(x = Age, y = logit_prob, color = factor(Heart.Disease))) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Logistic Regression Predicted Risk vs Age",
    x = "Age",
    y = "Predicted Probability of Heart Disease",
    color = "Actual Heart Disease"
  ) +
  theme_minimal()

```

